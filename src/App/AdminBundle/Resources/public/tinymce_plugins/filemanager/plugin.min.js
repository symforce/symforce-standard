tinymce.PluginManager.add('filemanager', function(editor) {
    
    editor.settings.file_browser_callback = function(id, value, type, win) {
        
        var zIndex = editor.windowManager.zIndex; // TinyMCE 3
        // TinyMCE 4
        if (tinymce.ui.FloatPanel) {
                zIndex = tinymce.ui.FloatPanel.currentZIndex;
        }

        editor.windowManager.open({
            title:  editor.settings.filemanager.title ,
            file: editor.settings.filemanager.url + '?type=' + type + '&value=' + value ,
            filetype: 'all',
            classes: 'filemanager',
            width: 900,
            height: 600,
            inline: 1
        }, {
            callback: function(url){
                var fieldElm = win.document.getElementById(id);
                fieldElm.value = editor.convertURL( url , null, true); 
            }
        }) ;
    };
});